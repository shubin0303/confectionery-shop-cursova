name: Telegram Bot Runner

on:
  workflow_dispatch:
  push:
    branches: [ main ]
  schedule:
    - cron: '*/15 * * * *'  # –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 14  # –ù–∞ 1 –º–∏–Ω—É—Ç—É –º–µ–Ω—å—à–µ
    
    steps:
    - name: üì• –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      uses: actions/checkout@v4
      
    - name: ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
      run: npm install
      
    - name: ü§ñ –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞
      run: |
        echo "üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ $(date)"
        echo "–¢–æ–∫–µ–Ω: ${TELEGRAM_BOT_TOKEN:0:15}..."
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
        export NODE_TLS_REJECT_UNAUTHORIZED=0
        export NODE_ENV=production
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
        timeout 840 node bot.js || echo "‚úÖ –ë–æ—Ç –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É"
        
        echo "‚è≥ –°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É"
        
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
