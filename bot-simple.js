const TelegramBot = require('node-telegram-bot-api');

const TOKEN = process.env.TELEGRAM_BOT_TOKEN;

if (!TOKEN) {
    console.error('‚ùå –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω!');
    process.exit(1);
}

console.log('üöÄ –ó–∞–ø—É—Å–∫ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ –±–æ—Ç–∞...');

const bot = new TelegramBot(TOKEN, {
    polling: {
        interval: 2000,
        timeout: 60,
        autoStart: true
    }
});

// –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
bot.onText(/\/start/, (msg) => {
    bot.sendMessage(msg.chat.id, 
        `üéÇ –ö–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∞—è "–°–ª–∞–¥–∫–∞—è –†–∞–¥–æ—Å—Ç—å"\n\nüìç –ê–¥—Ä–µ—Å: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –°–ª–∞–¥–∫–∞—è, –¥. 10\nüìû –¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67\n‚è∞ –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã: 9:00-21:00\n\n–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ GitHub Actions.`
    );
});

bot.onText(/\/menu/, (msg) => {
    bot.sendMessage(msg.chat.id, 'üì¶ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤:\n\nüéÇ –¢–æ—Ä—Ç—ã\nüç∞ –ü–∏—Ä–æ–∂–Ω—ã–µ\nüßÅ –ö–∞–ø–∫–µ–π–∫–∏\nü•Ø –ú–∞–∫–∞—Ä—É–Ω—ã\n\n–î–ª—è –∑–∞–∫–∞–∑–∞ –∑–≤–æ–Ω–∏—Ç–µ: +7 (999) 123-45-67');
});

bot.onText(/\/contacts/, (msg) => {
    bot.sendMessage(msg.chat.id, 'üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã:\n\n–¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67\n–ê–¥—Ä–µ—Å: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –°–ª–∞–¥–∫–∞—è, –¥. 10\n–°–∞–π—Ç: https://sweet-joy.example.com');
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª—é–±—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
bot.on('message', (msg) => {
    if (!msg.text.startsWith('/')) {
        bot.sendMessage(msg.chat.id, `–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã:\n/start - –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã\n/menu - –º–µ–Ω—é —Ç–æ–≤–∞—Ä–æ–≤\n/contacts - –∫–æ–Ω—Ç–∞–∫—Ç—ã –º–∞–≥–∞–∑–∏–Ω–∞`);
    }
});

// –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
bot.on('polling_error', (error) => {
    console.log(`üì° –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${error.code}`);
    
    if (error.code === 'ETELEGRAM') {
        console.log('‚è≥ Telegram API –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü—Ä–æ–¥–æ–ª–∂–∞—é –ø–æ–ø—ã—Ç–∫–∏...');
        // –ù–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º polling, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
    }
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
bot.getMe().then(info => {
    console.log(`‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω: @${info.username}`);
}).catch(err => {
    console.log('‚ö†Ô∏è  –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–æ—Ç–∞, –Ω–æ polling –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è');
});
